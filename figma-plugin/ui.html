<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <style>
    /* ============================================
       UX AI Generator — Figma Plugin UI
       Light board aesthetic · Matching landing page
       ============================================ */

    :root {
      --bg: #f5f5f4;
      --panel: #ffffff;
      --card: #ffffff;
      --card-alt: #fafaf9;
      --inset: #f5f5f4;
      --text: #1c1917;
      --text-muted: #78716c;
      --text-faint: #a8a29e;
      --line: #e7e5e4;
      --line-strong: #d6d3d1;
      --accent: #2563eb;
      --accent-soft: rgba(37,99,235,.08);
      --accent-border: rgba(37,99,235,.25);
      --success: #16a34a;
      --success-soft: rgba(22,163,74,.1);
      --warning: #d97706;
      --error: #dc2626;
      --radius: 10px;
      --radius-sm: 8px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      font-size: 12px;
      line-height: 1.5;
      padding: 14px;
      min-height: 100vh;
    }

    /* Header */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--line);
    }

    .header h1 {
      font-size: 15px;
      font-weight: 700;
      color: var(--text);
    }

    .progress-badge {
      padding: 5px 10px;
      border-radius: 999px;
      background: var(--accent-soft);
      border: 1px solid var(--accent-border);
      font-size: 10px;
      font-weight: 600;
      color: var(--accent);
    }

    .progress-badge.complete {
      background: var(--success-soft);
      border-color: rgba(22,163,74,.25);
      color: var(--success);
    }

    /* Tabs */
    .tabs-nav {
      display: flex;
      gap: 3px;
      padding: 5px;
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      margin-bottom: 14px;
      overflow-x: auto;
      flex-wrap: wrap;
      box-shadow: 0 1px 2px rgba(0,0,0,.04);
    }

    .tab {
      padding: 6px 10px;
      border: 1px solid transparent;
      background: transparent;
      color: var(--text-muted);
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 11px;
      font-weight: 600;
      white-space: nowrap;
      transition: all .15s;
    }

    .tab:hover { background: var(--inset); color: var(--text); }
    .tab.active { background: var(--accent-soft); border-color: var(--accent-border); color: var(--accent); }
    .tab.complete { background: var(--success-soft) !important; border-color: rgba(22,163,74,.25) !important; color: var(--success) !important; }

    /* Cards */
    .card {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: 14px;
      display: none;
      box-shadow: 0 1px 3px rgba(0,0,0,.04);
    }

    .card.active { display: block; }
    .card.complete { border-color: rgba(22,163,74,.35); }

    .card-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .card h2 {
      font-size: 14px;
      font-weight: 700;
      color: var(--text);
    }

    .req {
      color: var(--text-faint);
      font-size: 9px;
      font-weight: 600;
      letter-spacing: .04em;
      text-transform: uppercase;
      border: 1px solid var(--line);
      padding: 3px 8px;
      border-radius: 999px;
      background: var(--card-alt);
    }

    /* Fields */
    .field { margin-top: 12px; }
    .field:first-child { margin-top: 0; }

    label {
      display: block;
      font-size: 11px;
      font-weight: 600;
      margin-bottom: 5px;
      color: var(--text);
    }

    .input, textarea, select {
      width: 100%;
      background: var(--panel);
      color: var(--text);
      border: 1px solid var(--line);
      border-radius: var(--radius-sm);
      padding: 9px 11px;
      font-size: 12px;
      font-family: inherit;
      outline: none;
      transition: border-color .15s, box-shadow .15s;
    }

    textarea { min-height: 65px; resize: vertical; }

    .input::placeholder, textarea::placeholder { color: var(--text-faint); }

    .input:focus, textarea:focus, select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent-soft);
    }

    select {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%2378716c' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      padding-right: 28px;
      cursor: pointer;
    }

    /* Checkbox grid */
    .checkbox-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 5px;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 7px 9px;
      border-radius: var(--radius-sm);
      background: var(--panel);
      border: 1px solid var(--line);
      cursor: pointer;
      font-size: 10px;
      user-select: none;
      transition: all .15s;
    }

    .checkbox-item:hover { border-color: var(--line-strong); background: var(--card-alt); }
    .checkbox-item:has(input:checked) { background: var(--accent-soft); border-color: var(--accent-border); }
    .checkbox-item input[type="checkbox"] { width: auto; margin: 0; cursor: pointer; accent-color: var(--accent); }
    .checkbox-item span { color: var(--text-muted); }
    .checkbox-item input:checked + span { color: var(--accent); font-weight: 600; }

    /* Radio list */
    .radio-list { display: grid; gap: 5px; margin-top: 6px; }

    .radio {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 7px 10px;
      border-radius: var(--radius-sm);
      background: var(--panel);
      border: 1px solid var(--line);
      cursor: pointer;
      user-select: none;
      transition: all .15s;
    }

    .radio:hover { border-color: var(--line-strong); }
    .radio:has(input:checked) { background: var(--accent-soft); border-color: var(--accent-border); }
    .radio input { cursor: pointer; accent-color: var(--accent); }
    .radio span { color: var(--text-muted); font-size: 11px; }
    .radio input:checked + span { color: var(--accent); font-weight: 600; }

    /* Buttons */
    .btn {
      border: 0;
      border-radius: var(--radius-sm);
      padding: 9px 16px;
      font-weight: 600;
      font-size: 12px;
      cursor: pointer;
      color: #fff;
      background: var(--text);
      transition: all .15s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn:hover:not(:disabled) { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,.15); }
    .btn:disabled { opacity: .4; cursor: not-allowed; transform: none !important; }

    .btn.secondary {
      color: var(--text);
      background: var(--panel);
      border: 1px solid var(--line);
    }

    .btn.secondary:hover:not(:disabled) { background: var(--card-alt); border-color: var(--line-strong); }

    .btn svg { width: 13px; height: 13px; }

    /* Section nav */
    .section-nav {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      margin-top: 14px;
      padding-top: 12px;
      border-top: 1px solid var(--line);
    }

    .section-nav .btn { flex: 1; justify-content: center; }

    /* Actions */
    .actions {
      display: flex;
      gap: 8px;
      margin-top: 14px;
      flex-wrap: wrap;
    }

    .actions .btn { flex: 1; justify-content: center; }

    /* Theme selector */
    .theme-selector {
      display: flex;
      gap: 5px;
      margin-top: 10px;
    }

    .theme-option {
      flex: 1;
      padding: 9px;
      border: 1px solid var(--line);
      border-radius: var(--radius-sm);
      background: var(--panel);
      cursor: pointer;
      text-align: center;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      transition: all .15s;
    }

    .theme-option:hover { border-color: var(--line-strong); background: var(--card-alt); }
    .theme-option.active { border-color: var(--accent); background: var(--accent-soft); color: var(--accent); }

    /* Status */
    .status {
      margin-top: 12px;
      padding: 10px;
      border-radius: var(--radius-sm);
      font-size: 11px;
      text-align: center;
      font-weight: 500;
    }

    .status.loading { background: var(--accent-soft); color: var(--accent); border: 1px solid var(--accent-border); }
    .status.success { background: var(--success-soft); color: var(--success); border: 1px solid rgba(22,163,74,.25); }
    .status.error { background: rgba(220,38,38,.08); color: var(--error); border: 1px solid rgba(220,38,38,.25); }

    /* Mode Selector */
    .mode-selector {
      display: flex;
      gap: 4px;
      padding: 5px;
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      margin-bottom: 14px;
      box-shadow: 0 1px 2px rgba(0,0,0,.04);
    }

    .mode-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 9px 14px;
      border: 1px solid transparent;
      background: transparent;
      color: var(--text-muted);
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 11px;
      font-weight: 600;
      transition: all .15s;
    }

    .mode-btn:hover { background: var(--card-alt); color: var(--text); }
    .mode-btn.active { background: var(--accent-soft); border-color: var(--accent-border); color: var(--accent); }

    /* Paste Panel */
    .paste-panel {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: 14px;
      margin-bottom: 14px;
      box-shadow: 0 1px 3px rgba(0,0,0,.04);
    }

    .paste-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .paste-info p {
      font-size: 11px;
      color: var(--text-muted);
    }

    .webapp-link {
      font-size: 10px;
      color: var(--accent);
      text-decoration: none;
      padding: 5px 10px;
      background: var(--accent-soft);
      border: 1px solid var(--accent-border);
      border-radius: 6px;
      font-weight: 600;
    }

    .webapp-link:hover { background: rgba(37,99,235,.12); }

    .json-textarea {
      width: 100%;
      min-height: 120px;
      background: var(--card-alt);
      color: var(--text);
      border: 1px solid var(--line);
      border-radius: var(--radius-sm);
      padding: 10px;
      font-size: 10px;
      font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
      resize: vertical;
    }

    .json-textarea::placeholder { color: var(--text-faint); }

    .json-textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent-soft);
      outline: none;
    }

    .paste-actions {
      margin-top: 14px;
    }

    /* Utilities */
    .sub { color: var(--text-faint); font-size: 10px; margin-top: 4px; }
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div class="header">
    <h1>UX AI Generator</h1>
    <div class="progress-badge" id="progressBadge">
      <span class="progress-text">0/10</span>
    </div>
  </div>

  <!-- Mode Selector -->
  <div class="mode-selector" id="modeSelector">
    <button type="button" class="mode-btn active" data-mode="form">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
      </svg>
      Generar aqui
    </button>
    <button type="button" class="mode-btn" data-mode="paste">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="9" y="9" width="13" height="13" rx="2"/>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
      </svg>
      Pegar JSON
    </button>
  </div>

  <!-- Paste JSON Panel (hidden by default) -->
  <div class="paste-panel" id="pastePanel" style="display: none;">
    <div class="paste-info">
      <p>Copia el JSON desde la webapp y pegalo aqui:</p>
      <a href="https://josealvarezswork.github.io/uxgenerative/" target="_blank" class="webapp-link">Abrir webapp ↗</a>
    </div>
    <textarea id="jsonInput" class="json-textarea" placeholder='{"project_overview": {...}, "user_persona": {...}, ...}'></textarea>
    <div class="paste-actions">
      <div class="field" style="margin: 0;">
        <label style="margin-bottom: 4px;">Tema</label>
        <div class="theme-selector" style="margin: 0;">
          <button type="button" class="theme-option active" data-theme="dark">Dark</button>
          <button type="button" class="theme-option" data-theme="light">Light</button>
          <button type="button" class="theme-option" data-theme="notion">Notion</button>
        </div>
      </div>
      <div class="field" style="margin: 8px 0 0 0;">
        <label style="margin-bottom: 4px;">Layout</label>
        <div class="theme-selector layout-selector" style="margin: 0;">
          <button type="button" class="theme-option layout-option active" data-layout="vertical">Vertical</button>
          <button type="button" class="theme-option layout-option" data-layout="horizontal">Horizontal</button>
          <button type="button" class="theme-option layout-option" data-layout="separate">Separadas</button>
        </div>
      </div>
      <button type="button" class="btn" id="generateFromJson" style="margin-top: 12px; width: 100%; justify-content: center;">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
        </svg>
        Generar en Figma
      </button>
    </div>
    <div id="pasteStatusArea"></div>
  </div>

  <nav class="tabs-nav" id="tabsNav">
    <button type="button" class="tab active" data-section="1">1</button>
    <button type="button" class="tab" data-section="2">2</button>
    <button type="button" class="tab" data-section="3">3</button>
    <button type="button" class="tab" data-section="4">4</button>
    <button type="button" class="tab" data-section="5">5</button>
    <button type="button" class="tab" data-section="6">6</button>
    <button type="button" class="tab" data-section="7">7</button>
    <button type="button" class="tab" data-section="8">8</button>
    <button type="button" class="tab" data-section="9">9</button>
    <button type="button" class="tab" data-section="10">10</button>
    <button type="button" class="tab" data-section="11">Gen</button>
  </nav>

  <form id="uxForm" novalidate>

    <!-- 1. PROJECT IDENTITY -->
    <div class="card active" data-section="1">
      <div class="card-title">
        <h2>1. Project Identity</h2>
        <span class="req">Required</span>
      </div>

      <div class="field">
        <label for="projectName">Project Name</label>
        <input class="input" id="projectName" name="projectName" required placeholder="Good Manual" />
      </div>

      <div class="field">
        <label for="oneSentence">One-sentence Description</label>
        <input class="input" id="oneSentence" name="oneSentence" maxlength="200" required placeholder="App movil para..." />
      </div>

      <div class="field">
        <label for="productType">Product Type</label>
        <select id="productType" name="productType" required>
          <option value="" selected disabled>Selecciona...</option>
          <option value="App">App</option>
          <option value="Platform">Platform</option>
          <option value="Service">Service</option>
          <option value="Tool">Tool</option>
          <option value="Hardware">Hardware</option>
          <option value="Hybrid">Hybrid</option>
        </select>
      </div>

      <div class="field">
        <label>Primary Platform(s)</label>
        <div class="checkbox-grid">
          <label class="checkbox-item"><input type="checkbox" name="primaryPlatforms" value="Mobile" /><span>Mobile</span></label>
          <label class="checkbox-item"><input type="checkbox" name="primaryPlatforms" value="Web" /><span>Web</span></label>
          <label class="checkbox-item"><input type="checkbox" name="primaryPlatforms" value="Desktop" /><span>Desktop</span></label>
          <label class="checkbox-item"><input type="checkbox" name="primaryPlatforms" value="Tablet" /><span>Tablet</span></label>
          <label class="checkbox-item"><input type="checkbox" name="primaryPlatforms" value="Physical" /><span>Physical</span></label>
          <label class="checkbox-item"><input type="checkbox" name="primaryPlatforms" value="Hybrid" /><span>Hybrid</span></label>
        </div>
      </div>

      <div class="section-nav">
        <button type="button" class="btn secondary" data-nav="prev" disabled>Anterior</button>
        <button type="button" class="btn" data-nav="next">Siguiente</button>
      </div>
    </div>

    <!-- 2. PROBLEM & CONTEXT -->
    <div class="card" data-section="2">
      <div class="card-title">
        <h2>2. Problem & Context</h2>
        <span class="req">Required</span>
      </div>

      <div class="field">
        <label for="realWorldSituation">Real-world situation</label>
        <textarea id="realWorldSituation" name="realWorldSituation" required placeholder="Que esta pasando hoy? Quien lo vive?"></textarea>
      </div>

      <div class="field">
        <label for="whatGoesWrong">What goes wrong?</label>
        <textarea id="whatGoesWrong" name="whatGoesWrong" required placeholder="Que falla y que consecuencias tiene?"></textarea>
      </div>

      <div class="field">
        <label for="currentWorkarounds">Current workarounds</label>
        <textarea id="currentWorkarounds" name="currentWorkarounds" required placeholder="Que hacen hoy? Que herramientas usan?"></textarea>
      </div>

      <div class="section-nav">
        <button type="button" class="btn secondary" data-nav="prev">Anterior</button>
        <button type="button" class="btn" data-nav="next">Siguiente</button>
      </div>
    </div>

    <!-- 3. USER EVIDENCE -->
    <div class="card" data-section="3">
      <div class="card-title">
        <h2>3. User Evidence</h2>
        <span class="req">Required</span>
      </div>

      <div class="field">
        <label for="userRoleContext">User role & context</label>
        <input class="input" id="userRoleContext" name="userRoleContext" required placeholder='Ej: "Tecnicos aeronauticos en hangar..."' />
      </div>

      <div class="field">
        <label for="tryingToAccomplish">What they're trying to accomplish</label>
        <textarea id="tryingToAccomplish" name="tryingToAccomplish" required placeholder="Objetivo + por que importa"></textarea>
      </div>

      <div class="field">
        <label>Research backing</label>
        <div class="radio-list">
          <label class="radio"><input type="checkbox" name="researchBacking" value="User interviews" /><span>User interviews</span></label>
          <label class="radio"><input type="checkbox" name="researchBacking" value="Surveys/Analytics" /><span>Surveys/Analytics</span></label>
          <label class="radio"><input type="checkbox" name="researchBacking" value="Observation/Desk research" /><span>Observation/Desk</span></label>
          <label class="radio"><input type="checkbox" name="researchBacking" value="No research yet" /><span>No research yet</span></label>
        </div>
      </div>

      <div class="field">
        <label for="researchBackingDetails">Research Details</label>
        <textarea id="researchBackingDetails" name="researchBackingDetails" required placeholder="Key findings or quotes"></textarea>
      </div>

      <div class="section-nav">
        <button type="button" class="btn secondary" data-nav="prev">Anterior</button>
        <button type="button" class="btn" data-nav="next">Siguiente</button>
      </div>
    </div>

    <!-- 4. VALUE HYPOTHESIS -->
    <div class="card" data-section="4">
      <div class="card-title">
        <h2>4. Value Hypothesis</h2>
        <span class="req">Required</span>
      </div>

      <div class="field">
        <label for="desiredOutcome">Desired outcome</label>
        <textarea id="desiredOutcome" name="desiredOutcome" required placeholder="Como seria mejor? Como sabria el usuario que funciono?"></textarea>
      </div>

      <div class="field">
        <label for="whyUseThis">Why they'd use this</label>
        <textarea id="whyUseThis" name="whyUseThis" required placeholder="Core value prop + cambio de comportamiento esperado"></textarea>
      </div>

      <div class="field">
        <label for="productGoals">Product Goals (2-3 bullets)</label>
        <textarea id="productGoals" name="productGoals" required placeholder="- Reducir tiempo de X a Y&#10;- Aumentar visibilidad de Z"></textarea>
      </div>

      <div class="section-nav">
        <button type="button" class="btn secondary" data-nav="prev">Anterior</button>
        <button type="button" class="btn" data-nav="next">Siguiente</button>
      </div>
    </div>

    <!-- 5. SCOPE -->
    <div class="card" data-section="5">
      <div class="card-title">
        <h2>5. Scope</h2>
        <span class="req">Required</span>
      </div>

      <div class="field">
        <label for="mustHaveFeatures">Must-Have Features (3-5)</label>
        <textarea id="mustHaveFeatures" name="mustHaveFeatures" required placeholder="- ..."></textarea>
      </div>

      <div class="field">
        <label for="niceToHave">Nice-to-Have (optional)</label>
        <textarea id="niceToHave" name="niceToHave" placeholder="- ..."></textarea>
      </div>

      <div class="field">
        <label for="outOfScope">Out of Scope (optional)</label>
        <textarea id="outOfScope" name="outOfScope" placeholder="- ..."></textarea>
      </div>

      <div class="section-nav">
        <button type="button" class="btn secondary" data-nav="prev">Anterior</button>
        <button type="button" class="btn" data-nav="next">Siguiente</button>
      </div>
    </div>

    <!-- 6. CONSTRAINTS -->
    <div class="card" data-section="6">
      <div class="card-title">
        <h2>6. Constraints</h2>
        <span class="req">Required</span>
      </div>

      <div class="field">
        <label for="technicalPlatformConstraints">Technical & Platform</label>
        <textarea id="technicalPlatformConstraints" name="technicalPlatformConstraints" required placeholder="Limitaciones tecnicas, devices, APIs"></textarea>
      </div>

      <div class="field">
        <label for="businessTimelineConstraints">Business & Timeline</label>
        <textarea id="businessTimelineConstraints" name="businessTimelineConstraints" required placeholder="Budget, equipo, deadlines"></textarea>
      </div>

      <div class="field">
        <label for="adoptionRisks">Adoption Risks</label>
        <textarea id="adoptionRisks" name="adoptionRisks" required placeholder="Barriers, competencia, resistencia"></textarea>
      </div>

      <div class="section-nav">
        <button type="button" class="btn secondary" data-nav="prev">Anterior</button>
        <button type="button" class="btn" data-nav="next">Siguiente</button>
      </div>
    </div>

    <!-- 7. SUCCESS METRICS -->
    <div class="card" data-section="7">
      <div class="card-title">
        <h2>7. Success Metrics</h2>
        <span class="req">Required</span>
      </div>

      <div class="field">
        <label for="keyMetrics">Key Metrics (2-4)</label>
        <textarea id="keyMetrics" name="keyMetrics" required placeholder="Task completion: 45% -> 80%&#10;Weekly retention: Target 60%"></textarea>
      </div>

      <div class="section-nav">
        <button type="button" class="btn secondary" data-nav="prev">Anterior</button>
        <button type="button" class="btn" data-nav="next">Siguiente</button>
      </div>
    </div>

    <!-- 8. ASSUMPTIONS CHECK -->
    <div class="card" data-section="8">
      <div class="card-title">
        <h2>8. Assumptions Check</h2>
        <span class="req">Required</span>
      </div>

      <div class="field">
        <label for="facts">What you KNOW (facts)</label>
        <textarea id="facts" name="facts" required placeholder="Hechos confirmados + fuente"></textarea>
      </div>

      <div class="field">
        <label for="assumptions">What you ASSUME</label>
        <textarea id="assumptions" name="assumptions" required placeholder="Hipotesis clave"></textarea>
      </div>

      <div class="field">
        <label for="needsValidation">What needs validation</label>
        <input class="input" id="needsValidation" name="needsValidation" required placeholder="Que validar antes/despues" />
      </div>

      <div class="section-nav">
        <button type="button" class="btn secondary" data-nav="prev">Anterior</button>
        <button type="button" class="btn" data-nav="next">Siguiente</button>
      </div>
    </div>

    <!-- 9. PERSONA ESSENTIALS -->
    <div class="card" data-section="9">
      <div class="card-title">
        <h2>9. Persona Essentials</h2>
        <span class="req">Required</span>
      </div>

      <div class="field">
        <label for="ageOccupation">Age range & Occupation</label>
        <input class="input" id="ageOccupation" name="ageOccupation" required placeholder="25-35, Tecnico de mantenimiento..." />
      </div>

      <div class="field">
        <label for="techProficiency">Tech proficiency</label>
        <select id="techProficiency" name="techProficiency" required>
          <option value="" selected disabled>Selecciona...</option>
          <option value="Savvy">Savvy</option>
          <option value="Comfortable">Comfortable</option>
          <option value="Basic">Basic</option>
        </select>
      </div>

      <div class="field">
        <label for="mainMotivations">Main motivations</label>
        <input class="input" id="mainMotivations" name="mainMotivations" required placeholder="Seguridad, rapidez, precision..." />
      </div>

      <div class="field">
        <label for="dailyRoutineSnapshot">Daily routine snapshot</label>
        <textarea id="dailyRoutineSnapshot" name="dailyRoutineSnapshot" required placeholder="Como es un dia tipico?"></textarea>
      </div>

      <div class="section-nav">
        <button type="button" class="btn secondary" data-nav="prev">Anterior</button>
        <button type="button" class="btn" data-nav="next">Siguiente</button>
      </div>
    </div>

    <!-- 10. JOURNEY STAGES -->
    <div class="card" data-section="10">
      <div class="card-title">
        <h2>10. Journey Stages</h2>
        <span class="req">Required</span>
      </div>

      <div class="field">
        <label for="numStages">Number of stages (3-5)</label>
        <input class="input" type="number" id="numStages" name="numStages" min="3" max="5" value="3" required />
      </div>

      <div id="stagesContainer"></div>

      <div class="field">
        <label for="opportunityAreas">Opportunity areas</label>
        <textarea id="opportunityAreas" name="opportunityAreas" required placeholder="Donde podemos mejorar la experiencia?"></textarea>
      </div>

      <div class="section-nav">
        <button type="button" class="btn secondary" data-nav="prev">Anterior</button>
        <button type="button" class="btn" data-nav="next">Generate</button>
      </div>
    </div>

    <!-- 11. GENERATE -->
    <div class="card" data-section="11">
      <div class="card-title">
        <h2>Generate & Create</h2>
        <span class="req">Final Step</span>
      </div>

      <div class="field">
        <label>Theme</label>
        <div class="theme-selector">
          <button type="button" class="theme-option active" data-theme="dark">Dark</button>
          <button type="button" class="theme-option" data-theme="light">Light</button>
          <button type="button" class="theme-option" data-theme="notion">Notion</button>
        </div>
      </div>

      <div class="field">
        <label>Layout</label>
        <div class="theme-selector layout-selector">
          <button type="button" class="theme-option layout-option active" data-layout="vertical">Vertical</button>
          <button type="button" class="theme-option layout-option" data-layout="horizontal">Horizontal</button>
          <button type="button" class="theme-option layout-option" data-layout="separate">Separadas</button>
        </div>
      </div>

      <div class="actions">
        <button class="btn" type="submit" id="submitBtn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
          </svg>
          Generar en Figma
        </button>
      </div>

      <div id="statusArea"></div>

      <div class="section-nav">
        <button type="button" class="btn secondary" data-nav="prev">Anterior</button>
      </div>
    </div>

  </form>

  <script>
    // =======================
    // Configuration
    // =======================
    const API_URL = 'https://broad-shadow-d8e2.josealvarezswork.workers.dev/api/generate';
    let selectedTheme = 'dark';
    let selectedLayout = 'vertical';
    let currentSection = 1;
    let currentMode = 'form';
    const totalSections = 10;

    // =======================
    // Mode Switching
    // =======================
    const modeSelector = document.getElementById('modeSelector');
    const pastePanel = document.getElementById('pastePanel');
    const tabsNav = document.getElementById('tabsNav');
    const formElement = document.getElementById('uxForm');
    const progressBadge = document.getElementById('progressBadge');

    modeSelector.addEventListener('click', (e) => {
      const btn = e.target.closest('.mode-btn');
      if (!btn) return;

      const mode = btn.dataset.mode;
      currentMode = mode;

      // Update active button
      document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      // Show/hide panels
      if (mode === 'paste') {
        pastePanel.style.display = 'block';
        tabsNav.style.display = 'none';
        formElement.style.display = 'none';
        progressBadge.style.display = 'none';
      } else {
        pastePanel.style.display = 'none';
        tabsNav.style.display = 'flex';
        formElement.style.display = 'block';
        progressBadge.style.display = 'block';
      }
    });

    // =======================
    // Generate from Pasted JSON
    // =======================
    const jsonInput = document.getElementById('jsonInput');
    const generateFromJsonBtn = document.getElementById('generateFromJson');
    const pasteStatusArea = document.getElementById('pasteStatusArea');

    // Theme selector in paste panel
    document.querySelectorAll('.paste-panel .theme-option:not(.layout-option)').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.paste-panel .theme-option:not(.layout-option)').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedTheme = btn.dataset.theme;
      });
    });

    // Layout selector in paste panel
    document.querySelectorAll('.paste-panel .layout-option').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.paste-panel .layout-option').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedLayout = btn.dataset.layout;
      });
    });

    generateFromJsonBtn.addEventListener('click', () => {
      const jsonText = jsonInput.value.trim();

      if (!jsonText) {
        pasteStatusArea.innerHTML = '<div class="status error">Pega el JSON primero</div>';
        return;
      }

      try {
        const data = JSON.parse(jsonText);

        pasteStatusArea.innerHTML = '<div class="status loading">Creando frames...</div>';
        generateFromJsonBtn.disabled = true;

        parent.postMessage({
          pluginMessage: {
            type: 'generate',
            data: data,
            options: { theme: selectedTheme, layout: selectedLayout }
          }
        }, '*');

      } catch (err) {
        pasteStatusArea.innerHTML = '<div class="status error">JSON invalido: ' + err.message + '</div>';
      }
    });

    // =======================
    // DOM Elements
    // =======================
    const form = document.getElementById('uxForm');
    const statusArea = document.getElementById('statusArea');
    const stagesContainer = document.getElementById('stagesContainer');
    const numStagesInput = document.getElementById('numStages');

    // =======================
    // Tab Navigation
    // =======================
    function switchTab(section) {
      if (section < 1 || section > 11) return;

      currentSection = section;

      // Update cards
      document.querySelectorAll('.card[data-section]').forEach(card => {
        card.classList.toggle('active', parseInt(card.dataset.section) === section);
      });

      // Update tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.toggle('active', parseInt(tab.dataset.section) === section);
      });

      // Update prev/next buttons
      document.querySelectorAll('[data-nav="prev"]').forEach(btn => {
        btn.disabled = section === 1;
      });
    }

    // Tab click handler
    tabsNav.addEventListener('click', (e) => {
      const tab = e.target.closest('.tab');
      if (tab) {
        switchTab(parseInt(tab.dataset.section));
      }
    });

    // Navigation buttons
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('[data-nav]');
      if (!btn) return;

      e.preventDefault();
      const direction = btn.dataset.nav;

      if (direction === 'next') {
        switchTab(currentSection + 1);
      } else if (direction === 'prev') {
        switchTab(currentSection - 1);
      }
    });

    // =======================
    // Theme Selection
    // =======================
    document.querySelectorAll('#uxForm .theme-option:not(.layout-option)').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('#uxForm .theme-option:not(.layout-option)').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedTheme = btn.dataset.theme;
      });
    });

    // =======================
    // Layout Selection
    // =======================
    document.querySelectorAll('#uxForm .layout-option').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('#uxForm .layout-option').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedLayout = btn.dataset.layout;
      });
    });

    // =======================
    // Dynamic Stages
    // =======================
    function renderStages() {
      const num = parseInt(numStagesInput.value) || 3;
      stagesContainer.innerHTML = '';

      for (let i = 1; i <= num; i++) {
        const stageHtml = `
          <div class="field">
            <label>Stage ${i}: Name & Action</label>
            <input class="input" name="stage${i}Name" placeholder="Stage name (e.g., Discovery)" />
            <textarea name="stage${i}Action" placeholder="What does the user do?" style="margin-top:4px"></textarea>
          </div>
        `;
        stagesContainer.insertAdjacentHTML('beforeend', stageHtml);
      }
    }

    numStagesInput.addEventListener('change', renderStages);
    renderStages();

    // =======================
    // Progress Tracking
    // =======================
    function updateProgress() {
      let completed = 0;

      for (let i = 1; i <= totalSections; i++) {
        const card = document.querySelector(`.card[data-section="${i}"]`);
        const tab = document.querySelector(`.tab[data-section="${i}"]`);
        if (!card || !tab) continue;

        const requiredInputs = card.querySelectorAll('[required]');
        const allFilled = Array.from(requiredInputs).every(input => {
          if (input.type === 'checkbox') {
            const checkboxes = card.querySelectorAll(`[name="${input.name}"]`);
            return Array.from(checkboxes).some(cb => cb.checked);
          }
          return input.value.trim() !== '';
        });

        if (allFilled && requiredInputs.length > 0) {
          completed++;
          card.classList.add('complete');
          tab.classList.add('complete');
        } else {
          card.classList.remove('complete');
          tab.classList.remove('complete');
        }
      }

      progressBadge.querySelector('.progress-text').textContent = `${completed}/${totalSections}`;
      progressBadge.classList.toggle('complete', completed === totalSections);
    }

    form.addEventListener('input', updateProgress);
    form.addEventListener('change', updateProgress);

    // =======================
    // Status Display
    // =======================
    function showStatus(message, type = 'loading') {
      statusArea.innerHTML = `<div class="status ${type}">${message}</div>`;
    }

    function clearStatus() {
      statusArea.innerHTML = '';
    }

    // =======================
    // Form Submission
    // =======================
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      showStatus('Generando UX Brief con AI...', 'loading');

      try {
        // Collect form data
        const formData = new FormData(form);
        const briefData = {};

        for (const [key, value] of formData.entries()) {
          if (key === 'primaryPlatforms' || key === 'researchBacking') {
            if (!briefData[key]) briefData[key] = [];
            briefData[key].push(value);
          } else {
            briefData[key] = value;
          }
        }

        // Collect stages
        const numStages = parseInt(briefData.numStages) || 3;
        briefData.stages = [];
        for (let i = 1; i <= numStages; i++) {
          briefData.stages.push({
            name: briefData[`stage${i}Name`] || `Stage ${i}`,
            action: briefData[`stage${i}Action`] || ''
          });
          delete briefData[`stage${i}Name`];
          delete briefData[`stage${i}Action`];
        }

        console.log('Sending to API:', briefData);

        // Call API
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(briefData)
        });

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`API Error: ${response.status} - ${errorText}`);
        }

        const apiResponse = await response.json();
        console.log('API Response:', apiResponse);

        // Parse the AI-generated JSON from result.result
        let parsedData;
        try {
          let jsonString = apiResponse.result || '{}';
          jsonString = jsonString.replace(/^```json\s*/i, '').replace(/\s*```$/i, '').trim();
          parsedData = JSON.parse(jsonString);
          if (!parsedData.projectName) {
            parsedData.projectName = briefData.projectName || 'UX Strategy Brief';
          }
        } catch (parseErr) {
          console.error('JSON parse error:', parseErr);
          throw new Error('Error parsing AI response');
        }

        console.log('Parsed data:', parsedData);
        showStatus('Creando frames en Figma...', 'loading');

        // Send to Figma plugin
        parent.postMessage({
          pluginMessage: {
            type: 'generate',
            data: parsedData,
            options: { theme: selectedTheme, layout: selectedLayout }
          }
        }, '*');

      } catch (error) {
        console.error('Error:', error);
        showStatus(`Error: ${error.message}`, 'error');
        submitBtn.disabled = false;
      }
    });

    // =======================
    // Listen for Figma Messages
    // =======================
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      if (!msg) return;

      if (msg.type === 'done') {
        if (currentMode === 'paste') {
          pasteStatusArea.innerHTML = '<div class="status success">Frames creados!</div>';
          generateFromJsonBtn.disabled = false;
        } else {
          showStatus('Frames creados exitosamente!', 'success');
          document.getElementById('submitBtn').disabled = false;
        }
      } else if (msg.type === 'error') {
        if (currentMode === 'paste') {
          pasteStatusArea.innerHTML = '<div class="status error">Error: ' + msg.message + '</div>';
          generateFromJsonBtn.disabled = false;
        } else {
          showStatus(`Error: ${msg.message}`, 'error');
          document.getElementById('submitBtn').disabled = false;
        }
      }
    };

    // =======================
    // Load Example Data
    // =======================
    function loadExample() {
      const example = {
        projectName: 'Good Manual',
        oneSentence: 'App movil para tecnicos aeronauticos que digitaliza manuales de mantenimiento',
        productType: 'App',
        primaryPlatforms: ['Mobile', 'Tablet'],
        realWorldSituation: 'Tecnicos aeronauticos en hangares consultan manuales fisicos de 500+ paginas durante inspecciones',
        whatGoesWrong: 'Perdida de tiempo buscando procedimientos, errores por informacion desactualizada',
        currentWorkarounds: 'PDFs en tablet, fotos de paginas, notas en papel',
        userRoleContext: 'Tecnicos de mantenimiento aeronautico con 5-15 anos de experiencia',
        tryingToAccomplish: 'Completar inspecciones de forma rapida, segura y documentada',
        researchBacking: ['User interviews'],
        researchBackingDetails: 'Entrevistas con 12 tecnicos, promedio 45 min buscando info por turno',
        desiredOutcome: 'Reducir tiempo de busqueda de 45 min a 5 min por turno',
        whyUseThis: 'Acceso inmediato a procedimientos con busqueda inteligente',
        productGoals: '- Reducir tiempo de busqueda 90%\n- Eliminar errores por info desactualizada\n- Mejorar trazabilidad',
        mustHaveFeatures: '- Busqueda por voz\n- Modo offline\n- Alertas de actualizaciones\n- Checklist digital',
        niceToHave: '- Realidad aumentada\n- Colaboracion en tiempo real',
        outOfScope: '- Gestion de inventario\n- Facturacion',
        technicalPlatformConstraints: 'iOS/Android, funcionar offline, sincronizar con sistema existente',
        businessTimelineConstraints: 'MVP en 4 meses, presupuesto limitado, equipo de 3',
        adoptionRisks: 'Resistencia de tecnicos senior, dependencia de conectividad',
        keyMetrics: 'Tiempo de busqueda: 45min -> 5min\nAdopcion: 80% en 6 meses\nErrores: -50%',
        facts: 'Promedio 45 min/turno buscando info (medido en 3 hangares)',
        assumptions: 'Tecnicos prefieren digital si es mas rapido que papel',
        needsValidation: 'Usabilidad con guantes, rendimiento offline',
        ageOccupation: '35-55, Tecnico de mantenimiento aeronautico',
        techProficiency: 'Comfortable',
        mainMotivations: 'Seguridad, eficiencia, precision',
        dailyRoutineSnapshot: 'Llega 6am, revisa tareas asignadas, inspecciona aeronave, documenta hallazgos',
        numStages: '3',
        opportunityAreas: 'Busqueda predictiva, integracion con sistemas de la aerolinea'
      };

      // Fill form
      Object.entries(example).forEach(([key, value]) => {
        if (Array.isArray(value)) {
          value.forEach(v => {
            const checkbox = form.querySelector(`[name="${key}"][value="${v}"]`);
            if (checkbox) checkbox.checked = true;
          });
        } else {
          const input = form.querySelector(`[name="${key}"]`);
          if (input) input.value = value;
        }
      });

      renderStages();

      // Fill stage data
      form.querySelector('[name="stage1Name"]').value = 'Preparacion';
      form.querySelector('[name="stage1Action"]').value = 'Revisa tareas asignadas y recopila herramientas';
      form.querySelector('[name="stage2Name"]').value = 'Inspeccion';
      form.querySelector('[name="stage2Action"]').value = 'Ejecuta procedimientos consultando manual';
      form.querySelector('[name="stage3Name"]').value = 'Documentacion';
      form.querySelector('[name="stage3Action"]').value = 'Registra hallazgos y firma completado';

      updateProgress();
    }

    // Keyboard shortcut to load example (Cmd/Ctrl + E)
    document.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'e') {
        e.preventDefault();
        loadExample();
      }
    });

    // Initial progress update
    updateProgress();
  </script>
</body>
</html>
